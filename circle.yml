dependencies:
  pre:
    - createdb pigeon-backend-test
    - createuser pigeon-backend-test
    - echo '{:profiles/dev {:env {:connection-uri "jdbc:postgresql://localhost/pigeon-backend?user=pigeon-backend&password=pigeon-backend"}} :profiles/test {:env {:connection-uri "jdbc:postgresql://localhost/pigeon-backend-test?user=pigeon-backend-test&password=pigeon-backend-test"}}}' > profiles.clj
test:
  override:
    - lein with-profile +test midje
    - lein with-profile +test cloverage
  post:
    - lein run -m coveralls
    - bash -ex test/coveralls.sh
    - lein run -m pigeon-backend.coverage 86.03 95